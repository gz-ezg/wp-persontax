'use strict';

var _component = require('./../common/component.js');

(0, _component.VantComponent)({
  props: {
    title: String,
    value: String,
    loading: Boolean,
    itemHeight: {
      type: Number,
      value: 44
    },
    visibleItemCount: {
      type: Number,
      value: 5
    },
    columnsNum: {
      type: [String, Number],
      value: 3
    },
    areaList: {
      type: Object,
      value: {}
    }
  },
  data: {
    pickerValue: [0, 0, 0],
    columns: []
  },
  computed: {
    displayColumns: function displayColumns() {
      var _this$data = this.data,
          _this$data$columns = _this$data.columns,
          columns = _this$data$columns === void 0 ? [] : _this$data$columns,
          columnsNum = _this$data.columnsNum;
      return columns.slice(0, +columnsNum);
    }
  },
  watch: {
    value: function value(_value) {
      this.code = _value;
      this.setValues();
    },
    areaList: 'setValues'
  },
  methods: {
    onCancel: function onCancel() {
      this.$emit('cancel', {
        values: this.getValues(),
        indexs: this.getIndexs(),
        detail: this.getDetail()
      });
    },
    onConfirm: function onConfirm() {
      this.$emit('confirm', {
        values: this.getValues(),
        indexs: this.getIndexs(),
        detail: this.getDetail()
      });
    },
    onChange: function onChange(event) {
      var value = event.detail.value;
      var _this$data2 = this.data,
          pickerValue = _this$data2.pickerValue,
          displayColumns = _this$data2.displayColumns;
      var index = pickerValue.findIndex(function (item, index) {
        return item !== value[index];
      });
      var values = displayColumns[index];

      if (index < 0 || value[index] < 0 || !values[value[index]]) {
        return;
      }

      this.code = values[value[index]].code;
      this.setValues();
      this.$emit('change', {
        picker: this,
        values: this.getValues(),
        index: index
      });
    },
    getList: function getList(type, code) {
      var result = [];

      if (type !== 'province' && !code) {
        return result;
      }

      var list = this.data.areaList && this.data.areaList[type + "_list"] || {};
      result = Object.keys(list).map(function (code) {
        return {
          code: code,
          name: list[code]
        };
      });

      if (code) {
        // oversea code
        if (code[0] === '9' && type === 'city') {
          code = '9';
        }

        result = result.filter(function (item) {
          return item.code.indexOf(code) === 0;
        });
      }

      return result;
    },
    getIndex: function getIndex(type, code) {
      var compareNum = type === 'province' ? 2 : type === 'city' ? 4 : 6;
      var list = this.getList(type, code.slice(0, compareNum - 2)); // oversea code

      if (code[0] === '9' && type === 'province') {
        compareNum = 1;
      }

      code = code.slice(0, compareNum);

      for (var i = 0; i < list.length; i++) {
        if (list[i].code.slice(0, compareNum) === code) {
          return i;
        }
      }

      return 0;
    },
    setValues: function setValues() {
      var code = this.code || this.data.areaList && Object.keys(this.data.areaList.county_list || {})[0] || '';
      var province = this.getList('province');
      var city = this.getList('city', code.slice(0, 2));
      this.setData({
        'columns[0]': province,
        'columns[1]': city
      });

      if (city.length && code.slice(2, 4) === '00') {
        code = city[0].code;
      }

      this.setData({
        'columns[2]': this.getList('county', code.slice(0, 4)),
        pickerValue: [this.getIndex('province', code), this.getIndex('city', code), this.getIndex('county', code)]
      });
    },
    getValues: function getValues() {
      var _this$data3 = this.data,
          _this$data3$displayCo = _this$data3.displayColumns,
          displayColumns = _this$data3$displayCo === void 0 ? [] : _this$data3$displayCo,
          _this$data3$pickerVal = _this$data3.pickerValue,
          pickerValue = _this$data3$pickerVal === void 0 ? [] : _this$data3$pickerVal;
      return displayColumns.map(function (option, index) {
        return option[pickerValue[index]];
      }).filter(function (value) {
        return !!value;
      });
    },
    getIndexs: function getIndexs() {
      var _this$data4 = this.data,
          pickerValue = _this$data4.pickerValue,
          columnsNum = _this$data4.columnsNum;
      return pickerValue.slice(0, columnsNum);
    },
    getDetail: function getDetail() {
      var values = this.getValues();
      var area = {
        code: '',
        country: '',
        province: '',
        city: '',
        county: ''
      };

      if (!values.length) {
        return area;
      }

      var names = values.map(function (item) {
        return item.name;
      });
      area.code = values[values.length - 1].code;

      if (area.code[0] === '9') {
        area.country = names[1] || '';
        area.province = names[2] || '';
      } else {
        area.province = names[0] || '';
        area.city = names[1] || '';
        area.county = names[2] || '';
      }

      return area;
    },
    reset: function reset() {
      this.code = '';
      this.setValues();
    }
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbInByb3BzIiwidGl0bGUiLCJTdHJpbmciLCJ2YWx1ZSIsImxvYWRpbmciLCJCb29sZWFuIiwiaXRlbUhlaWdodCIsInR5cGUiLCJOdW1iZXIiLCJ2aXNpYmxlSXRlbUNvdW50IiwiY29sdW1uc051bSIsImFyZWFMaXN0IiwiT2JqZWN0IiwiZGF0YSIsInBpY2tlclZhbHVlIiwiY29sdW1ucyIsImNvbXB1dGVkIiwiZGlzcGxheUNvbHVtbnMiLCJfdGhpcyRkYXRhIiwiX3RoaXMkZGF0YSRjb2x1bW5zIiwic2xpY2UiLCJ3YXRjaCIsIl92YWx1ZSIsImNvZGUiLCJzZXRWYWx1ZXMiLCJtZXRob2RzIiwib25DYW5jZWwiLCIkZW1pdCIsInZhbHVlcyIsImdldFZhbHVlcyIsImluZGV4cyIsImdldEluZGV4cyIsImRldGFpbCIsImdldERldGFpbCIsIm9uQ29uZmlybSIsIm9uQ2hhbmdlIiwiZXZlbnQiLCJfdGhpcyRkYXRhMiIsImluZGV4IiwiZmluZEluZGV4IiwiaXRlbSIsInBpY2tlciIsImdldExpc3QiLCJyZXN1bHQiLCJsaXN0Iiwia2V5cyIsIm1hcCIsIm5hbWUiLCJmaWx0ZXIiLCJpbmRleE9mIiwiZ2V0SW5kZXgiLCJjb21wYXJlTnVtIiwiaSIsImxlbmd0aCIsImNvdW50eV9saXN0IiwicHJvdmluY2UiLCJjaXR5Iiwic2V0RGF0YSIsIl90aGlzJGRhdGEzIiwiX3RoaXMkZGF0YTMkZGlzcGxheUNvIiwiX3RoaXMkZGF0YTMkcGlja2VyVmFsIiwib3B0aW9uIiwiX3RoaXMkZGF0YTQiLCJhcmVhIiwiY291bnRyeSIsImNvdW50eSIsIm5hbWVzIiwicmVzZXQiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBQ0EsOEJBQWM7QUFDWkEsU0FBTztBQUNMQyxXQUFPQyxNQURGO0FBRUxDLFdBQU9ELE1BRkY7QUFHTEUsYUFBU0MsT0FISjtBQUlMQyxnQkFBWTtBQUNWQyxZQUFNQyxNQURJO0FBRVZMLGFBQU87QUFGRyxL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LFVBQUksQ0FBQ3JDLE9BQU95QixNQUFaLEVBQW9CO0FBQ2xCLGVBQU9VLElBQVA7QUFDRDs7QUFFRCxVQUFJRyxRQUFRdEMsT0FBT2tCLEdBQVAsQ0FBVyxVQUFVTixJQUFWLEVBQWdCO0FBQ3JDLGVBQU9BLEtBQUtPLElBQVo7QUFDRCxPQUZXLENBQVo7QUFHQWdCLFdBQUt4QyxJQUFMLEdBQVlLLE9BQU9BLE9BQU95QixNQUFQLEdBQWdCLENBQXZCLEVBQTBCOUIsSUFBdEM7O0FBRUEsVUFBSXdDLEtBQUt4QyxJQUFMLENBQVUsQ0FBVixNQUFpQixHQUFyQixFQUEwQjtBQUN4QndDLGFBQUtDLE9BQUwsR0FBZUUsTUFBTSxDQUFOLEtBQVksRUFBM0I7QUFDQUgsYUFBS1IsUUFBTCxHQUFnQlcsTUFBTSxDQUFOLEtBQVksRUFBNUI7QUFDRCxPQUhELE1BR087QUFDTEgsYUFBS1IsUUFBTCxHQUFnQlcsTUFBTSxDQUFOLEtBQVksRUFBNUI7QUFDQUgsYUFBS1AsSUFBTCxHQUFZVSxNQUFNLENBQU4sS0FBWSxFQUF4QjtBQUNBSCxhQUFLRSxNQUFMLEdBQWNDLE1BQU0sQ0FBTixLQUFZLEVBQTFCO0FBQ0Q7O0FBRUQsYUFBT0gsSUFBUDtBQUNELEtBcEpNO0FBcUpQSSxXQUFPLFNBQVNBLEtBQVQsR0FBaUI7QUFDdEIsV0FBSzVDLElBQUwsR0FBWSxFQUFaO0FBQ0EsV0FBS0MsU0FBTDtBQUNEO0FBeEpNO0FBMUNHLENBQWQiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWYW50Q29tcG9uZW50IH0gZnJvbSAnLi4vY29tbW9uL2NvbXBvbmVudCc7XG5WYW50Q29tcG9uZW50KHtcbiAgcHJvcHM6IHtcbiAgICB0aXRsZTogU3RyaW5nLFxuICAgIHZhbHVlOiBTdHJpbmcsXG4gICAgbG9hZGluZzogQm9vbGVhbixcbiAgICBpdGVtSGVpZ2h0OiB7XG4gICAgICB0eXBlOiBOdW1iZXIsXG4gICAgICB2YWx1ZTogNDRcbiAgICB9LFxuICAgIHZpc2libGVJdGVtQ291bnQ6IHtcbiAgICAgIHR5cGU6IE51bWJlcixcbiAgICAgIHZhbHVlOiA1XG4gICAgfSxcbiAgICBjb2x1bW5zTnVtOiB7XG4gICAgICB0eXBlOiBbU3RyaW5nLCBOdW1iZXJdLFxuICAgICAgdmFsdWU6IDNcbiAgICB9LFxuICAgIGFyZWFMaXN0OiB7XG4gICAgICB0eXBlOiBPYmplY3QsXG4gICAgICB2YWx1ZToge31cbiAgICB9XG4gIH0sXG4gIGRhdGE6IHtcbiAgICBwaWNrZXJWYWx1ZTogWzAsIDAsIDBdLFxuICAgIGNvbHVtbnM6IFtdXG4gIH0sXG4gIGNvbXB1dGVkOiB7XG4gICAgZGlzcGxheUNvbHVtbnM6IGZ1bmN0aW9uIGRpc3BsYXlDb2x1bW5zKCkge1xuICAgICAgdmFyIF90aGlzJGRhdGEgPSB0aGlzLmRhdGEsXG4gICAgICAgICAgX3RoaXMkZGF0YSRjb2x1bW5zID0gX3RoaXMkZGF0YS5jb2x1bW5zLFxuICAgICAgICAgIGNvbHVtbnMgPSBfdGhpcyRkYXRhJGNvbHVtbnMgPT09IHZvaWQgMCA/IFtdIDogX3RoaXMkZGF0YSRjb2x1bW5zLFxuICAgICAgICAgIGNvbHVtbnNOdW0gPSBfdGhpcyRkYXRhLmNvbHVtbnNOdW07XG4gICAgICByZXR1cm4gY29sdW1ucy5zbGljZSgwLCArY29sdW1uc051bSk7XG4gICAgfVxuICB9LFxuICB3YXRjaDoge1xuICAgIHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShfdmFsdWUpIHtcbiAgICAgIHRoaXMuY29kZSA9IF92YWx1ZTtcbiAgICAgIHRoaXMuc2V0VmFsdWVzKCk7XG4gICAgfSxcbiAgICBhcmVhTGlzdDogJ3NldFZhbHVlcydcbiAgfSxcbiAgbWV0aG9kczoge1xuICAgIG9uQ2FuY2VsOiBmdW5jdGlvbiBvbkNhbmNlbCgpIHtcbiAgICAgIHRoaXMuJGVtaXQoJ2NhbmNlbCcsIHtcbiAgICAgICAgdmFsdWVzOiB0aGlzLmdldFZhbHVlcygpLFxuICAgICAgICBpbmRleHM6IHRoaXMuZ2V0SW5kZXhzKCksXG4gICAgICAgIGRldGFpbDogdGhpcy5nZXREZXRhaWwoKVxuICAgICAgfSk7XG4gICAgfSxcbiAgICBvbkNvbmZpcm06IGZ1bmN0aW9uIG9uQ29uZmlybSgpIHtcbiAgICAgIHRoaXMuJGVtaXQoJ2NvbmZpcm0nLCB7XG4gICAgICAgIHZhbHVlczogdGhpcy5nZXRWYWx1ZXMoKSxcbiAgICAgICAgaW5kZXhzOiB0aGlzLmdldEluZGV4cygpLFxuICAgICAgICBkZXRhaWw6IHRoaXMuZ2V0RGV0YWlsKClcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGV2ZW50KSB7XG4gICAgICB2YXIgdmFsdWUgPSBldmVudC5kZXRhaWwudmFsdWU7XG4gICAgICB2YXIgX3RoaXMkZGF0YTIgPSB0aGlzLmRhdGEsXG4gICAgICAgICAgcGlja2VyVmFsdWUgPSBfdGhpcyRkYXRhMi5waWNrZXJWYWx1ZSxcbiAgICAgICAgICBkaXNwbGF5Q29sdW1ucyA9IF90aGlzJGRhdGEyLmRpc3BsYXlDb2x1bW5zO1xuICAgICAgdmFyIGluZGV4ID0gcGlja2VyVmFsdWUuZmluZEluZGV4KGZ1bmN0aW9uIChpdGVtLCBpbmRleCkge1xuICAgICAgICByZXR1cm4gaXRlbSAhPT0gdmFsdWVbaW5kZXhdO1xuICAgICAgfSk7XG4gICAgICB2YXIgdmFsdWVzID0gZGlzcGxheUNvbHVtbnNbaW5kZXhdO1xuXG4gICAgICBpZiAoaW5kZXggPCAwIHx8IHZhbHVlW2luZGV4XSA8IDAgfHwgIXZhbHVlc1t2YWx1ZVtpbmRleF1dKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jb2RlID0gdmFsdWVzW3ZhbHVlW2luZGV4XV0uY29kZTtcbiAgICAgIHRoaXMuc2V0VmFsdWVzKCk7XG4gICAgICB0aGlzLiRlbWl0KCdjaGFuZ2UnLCB7XG4gICAgICAgIHBpY2tlcjogdGhpcyxcbiAgICAgICAgdmFsdWVzOiB0aGlzLmdldFZhbHVlcygpLFxuICAgICAgICBpbmRleDogaW5kZXhcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZ2V0TGlzdDogZnVuY3Rpb24gZ2V0TGlzdCh0eXBlLCBjb2RlKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gW107XG5cbiAgICAgIGlmICh0eXBlICE9PSAncHJvdmluY2UnICYmICFjb2RlKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG5cbiAgICAgIHZhciBsaXN0ID0gdGhpcy5kYXRhLmFyZWFMaXN0ICYmIHRoaXMuZGF0YS5hcmVhTGlzdFt0eXBlICsgXCJfbGlzdFwiXSB8fCB7fTtcbiAgICAgIHJlc3VsdCA9IE9iamVjdC5rZXlzKGxpc3QpLm1hcChmdW5jdGlvbiAoY29kZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGNvZGU6IGNvZGUsXG4gICAgICAgICAgbmFtZTogbGlzdFtjb2RlXVxuICAgICAgICB9O1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChjb2RlKSB7XG4gICAgICAgIC8vIG92ZXJzZWEgY29kZVxuICAgICAgICBpZiAoY29kZVswXSA9PT0gJzknICYmIHR5cGUgPT09ICdjaXR5Jykge1xuICAgICAgICAgIGNvZGUgPSAnOSc7XG4gICAgICAgIH1cblxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgcmV0dXJuIGl0ZW0uY29kZS5pbmRleE9mKGNvZGUpID09PSAwO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LFxuICAgIGdldEluZGV4OiBmdW5jdGlvbiBnZXRJbmRleCh0eXBlLCBjb2RlKSB7XG4gICAgICB2YXIgY29tcGFyZU51bSA9IHR5cGUgPT09ICdwcm92aW5jZScgPyAyIDogdHlwZSA9PT0gJ2NpdHknID8gNCA6IDY7XG4gICAgICB2YXIgbGlzdCA9IHRoaXMuZ2V0TGlzdCh0eXBlLCBjb2RlLnNsaWNlKDAsIGNvbXBhcmVOdW0gLSAyKSk7IC8vIG92ZXJzZWEgY29kZVxuXG4gICAgICBpZiAoY29kZVswXSA9PT0gJzknICYmIHR5cGUgPT09ICdwcm92aW5jZScpIHtcbiAgICAgICAgY29tcGFyZU51bSA9IDE7XG4gICAgICB9XG5cbiAgICAgIGNvZGUgPSBjb2RlLnNsaWNlKDAsIGNvbXBhcmVOdW0pO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGxpc3RbaV0uY29kZS5zbGljZSgwLCBjb21wYXJlTnVtKSA9PT0gY29kZSkge1xuICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAwO1xuICAgIH0sXG4gICAgc2V0VmFsdWVzOiBmdW5jdGlvbiBzZXRWYWx1ZXMoKSB7XG4gICAgICB2YXIgY29kZSA9IHRoaXMuY29kZSB8fCB0aGlzLmRhdGEuYXJlYUxpc3QgJiYgT2JqZWN0LmtleXModGhpcy5kYXRhLmFyZWFMaXN0LmNvdW50eV9saXN0IHx8IHt9KVswXSB8fCAnJztcbiAgICAgIHZhciBwcm92aW5jZSA9IHRoaXMuZ2V0TGlzdCgncHJvdmluY2UnKTtcbiAgICAgIHZhciBjaXR5ID0gdGhpcy5nZXRMaXN0KCdjaXR5JywgY29kZS5zbGljZSgwLCAyKSk7XG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAnY29sdW1uc1swXSc6IHByb3ZpbmNlLFxuICAgICAgICAnY29sdW1uc1sxXSc6IGNpdHlcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoY2l0eS5sZW5ndGggJiYgY29kZS5zbGljZSgyLCA0KSA9PT0gJzAwJykge1xuICAgICAgICBjb2RlID0gY2l0eVswXS5jb2RlO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAnY29sdW1uc1syXSc6IHRoaXMuZ2V0TGlzdCgnY291bnR5JywgY29kZS5zbGljZSgwLCA0KSksXG4gICAgICAgIHBpY2tlclZhbHVlOiBbdGhpcy5nZXRJbmRleCgncHJvdmluY2UnLCBjb2RlKSwgdGhpcy5nZXRJbmRleCgnY2l0eScsIGNvZGUpLCB0aGlzLmdldEluZGV4KCdjb3VudHknLCBjb2RlKV1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZ2V0VmFsdWVzOiBmdW5jdGlvbiBnZXRWYWx1ZXMoKSB7XG4gICAgICB2YXIgX3RoaXMkZGF0YTMgPSB0aGlzLmRhdGEsXG4gICAgICAgICAgX3RoaXMkZGF0YTMkZGlzcGxheUNvID0gX3RoaXMkZGF0YTMuZGlzcGxheUNvbHVtbnMsXG4gICAgICAgICAgZGlzcGxheUNvbHVtbnMgPSBfdGhpcyRkYXRhMyRkaXNwbGF5Q28gPT09IHZvaWQgMCA/IFtdIDogX3RoaXMkZGF0YTMkZGlzcGxheUNvLFxuICAgICAgICAgIF90aGlzJGRhdGEzJHBpY2tlclZhbCA9IF90aGlzJGRhdGEzLnBpY2tlclZhbHVlLFxuICAgICAgICAgIHBpY2tlclZhbHVlID0gX3RoaXMkZGF0YTMkcGlja2VyVmFsID09PSB2b2lkIDAgPyBbXSA6IF90aGlzJGRhdGEzJHBpY2tlclZhbDtcbiAgICAgIHJldHVybiBkaXNwbGF5Q29sdW1ucy5tYXAoZnVuY3Rpb24gKG9wdGlvbiwgaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbltwaWNrZXJWYWx1ZVtpbmRleF1dO1xuICAgICAgfSkuZmlsdGVyKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gISF2YWx1ZTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZ2V0SW5kZXhzOiBmdW5jdGlvbiBnZXRJbmRleHMoKSB7XG4gICAgICB2YXIgX3RoaXMkZGF0YTQgPSB0aGlzLmRhdGEsXG4gICAgICAgICAgcGlja2VyVmFsdWUgPSBfdGhpcyRkYXRhNC5waWNrZXJWYWx1ZSxcbiAgICAgICAgICBjb2x1bW5zTnVtID0gX3RoaXMkZGF0YTQuY29sdW1uc051bTtcbiAgICAgIHJldHVybiBwaWNrZXJWYWx1ZS5zbGljZSgwLCBjb2x1bW5zTnVtKTtcbiAgICB9LFxuICAgIGdldERldGFpbDogZnVuY3Rpb24gZ2V0RGV0YWlsKCkge1xuICAgICAgdmFyIHZhbHVlcyA9IHRoaXMuZ2V0VmFsdWVzKCk7XG4gICAgICB2YXIgYXJlYSA9IHtcbiAgICAgICAgY29kZTogJycsXG4gICAgICAgIGNvdW50cnk6ICcnLFxuICAgICAgICBwcm92aW5jZTogJycsXG4gICAgICAgIGNpdHk6ICcnLFxuICAgICAgICBjb3VudHk6ICcnXG4gICAgICB9O1xuXG4gICAgICBpZiAoIXZhbHVlcy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGFyZWE7XG4gICAgICB9XG5cbiAgICAgIHZhciBuYW1lcyA9IHZhbHVlcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgcmV0dXJuIGl0ZW0ubmFtZTtcbiAgICAgIH0pO1xuICAgICAgYXJlYS5jb2RlID0gdmFsdWVzW3ZhbHVlcy5sZW5ndGggLSAxXS5jb2RlO1xuXG4gICAgICBpZiAoYXJlYS5jb2RlWzBdID09PSAnOScpIHtcbiAgICAgICAgYXJlYS5jb3VudHJ5ID0gbmFtZXNbMV0gfHwgJyc7XG4gICAgICAgIGFyZWEucHJvdmluY2UgPSBuYW1lc1syXSB8fCAnJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFyZWEucHJvdmluY2UgPSBuYW1lc1swXSB8fCAnJztcbiAgICAgICAgYXJlYS5jaXR5ID0gbmFtZXNbMV0gfHwgJyc7XG4gICAgICAgIGFyZWEuY291bnR5ID0gbmFtZXNbMl0gfHwgJyc7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhcmVhO1xuICAgIH0sXG4gICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KCkge1xuICAgICAgdGhpcy5jb2RlID0gJyc7XG4gICAgICB0aGlzLnNldFZhbHVlcygpO1xuICAgIH1cbiAgfVxufSk7Il19